version: "2"
services:
  alluxio-master:
    image: potatobox/alluxio
    network_mode: host
    volumes:
      - alluxio:/var/lib/alluxio
      - alluxio_logs:/var/log/alluxio
      - ./conf/alluxio/alluxio-site.properties:/opt/alluxio/conf/alluxio-site.properties:ro
    command: alluxio-start.sh -w master

  alluxio-worker:
    image: potatobox/alluxio
    network_mode: host
    volumes:
      - alluxio:/var/lib/alluxio
      - alluxio_logs:/var/log/alluxio
      - ./conf/alluxio/alluxio-site.properties:/opt/alluxio/conf/alluxio-site.properties:ro
    command: alluxio-start.sh -w worker NoMount

  alluxio-job-master:
    image: potatobox/alluxio
    network_mode: host
    volumes:
      - alluxio:/var/lib/alluxio
      - alluxio_logs:/var/log/alluxio
      - ./conf/alluxio/alluxio-site.properties:/opt/alluxio/conf/alluxio-site.properties:ro
    command: alluxio-start.sh -w job_master

  alluxio-job-worker:
    image: potatobox/alluxio
    network_mode: host
    volumes:
      - alluxio:/var/lib/alluxio
      - alluxio_logs:/var/log/alluxio
      - ./conf/alluxio/alluxio-site.properties:/opt/alluxio/conf/alluxio-site.properties:ro
    command: alluxio-start.sh -w job_worker

  hive-metastore:
    image: potatobox/hive
    network_mode: host
    volumes:
      - hive:/var/lib/hive
      - hive_logs:/var/log/hive
      - alluxio:/var/lib/alluxio
      - alluxio_logs:/var/log/alluxio
      - ./conf/hive/hive-site.xml:/opt/hive/conf/hive-site.xml:ro
      - ./conf/hadoop/core-site.xml:/opt/hadoop/etc/hadoop/core-site.xml:ro
      - ./conf/alluxio/alluxio-site.properties:/opt/alluxio/conf/alluxio-site.properties:ro
    command: hive --service metastore

  presto-coordinator:
    image: potatobox/presto
    network_mode: host
    volumes:
      - presto:/var/lib/presto
      - presto_logs:/var/lib/presto/var/log
      - alluxio:/var/lib/alluxio
      - alluxio_logs:/var/log/alluxio
      - ./conf/presto-coordinator:/opt/presto/etc:ro
      - ./conf/hadoop/core-site.xml:/opt/hadoop/etc/hadoop/core-site.xml:ro
    command: /opt/presto/bin/launcher run

  # presto-worker:
  #   image: potatobox/presto
  #   network_mode: host
  #   volumes:
  #     - presto:/var/lib/presto
  #     - presto_logs:/var/lib/presto/var/log
  #     - alluxio:/var/lib/alluxio
  #     - alluxio_logs:/var/log/alluxio
  #     - ./conf/presto-worker:/opt/presto/etc:ro
  #     - ./conf/hadoop/core-site.xml:/opt/hadoop/etc/hadoop/core-site.xml:ro
  #   command: /opt/presto/bin/launcher run

volumes:
  alluxio: {}
  alluxio_logs: {}
  hive: {}
  hive_logs: {}
  presto: {}
  presto_logs: {}
